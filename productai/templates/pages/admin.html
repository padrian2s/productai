{% extends "base.html" %}
{% block title %}Admin â€” ProductAI{% endblock %}

{% block content %}
<div class="p-8 max-w-4xl mx-auto">
    <nav class="text-sm text-gray-500 mb-6">
        <a href="/" class="hover:text-brand-600">Dashboard</a>
        <span class="mx-2">/</span>
        <span class="text-gray-900">Admin</span>
    </nav>

    <h1 class="text-2xl font-bold mb-2">Admin Settings</h1>
    <p class="text-gray-500 mb-8">Configure AI enhancement prompts and API key. Changes take effect immediately.</p>

    <form action="/api/admin/settings" method="post" class="space-y-8">
        <!-- API Key -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center gap-3 mb-3">
                <span class="inline-flex px-2.5 py-1 text-xs font-semibold rounded-full bg-brand-100 text-brand-700">API</span>
                <h2 class="font-semibold text-gray-900">Claude API Key</h2>
            </div>
            {% if has_env_key %}
            <div class="flex items-center gap-2 text-sm text-emerald-700 bg-emerald-50 border border-emerald-200 rounded-lg px-4 py-3">
                <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                API key is set via <code class="bg-emerald-100 px-1.5 py-0.5 rounded text-xs font-mono">ANTHROPIC_API_KEY</code> environment variable. No action needed.
            </div>
            {% else %}
            <p class="text-sm text-gray-500 mb-3">
                No <code class="bg-gray-100 px-1.5 py-0.5 rounded text-xs font-mono">ANTHROPIC_API_KEY</code> environment variable detected.
                Enter your API key below to enable AI features.
            </p>
            {% set current_key = settings.get('anthropic_api_key', {}).get('value', '') %}
            <div class="relative">
                <input type="password" name="anthropic_api_key" id="api-key-input"
                    value="{{ current_key }}"
                    placeholder="sk-ant-api03-..."
                    class="w-full px-4 py-2.5 pr-10 rounded-lg border border-gray-300 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 outline-none transition-all font-mono text-sm">
                <button type="button" id="toggle-key-vis"
                    class="absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-400 hover:text-gray-600 transition-colors"
                    title="Show/hide key">
                    <svg class="eye-open w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
                    </svg>
                    <svg class="eye-closed w-4 h-4 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"/>
                        <line x1="1" y1="1" x2="23" y2="23"/>
                    </svg>
                </button>
            </div>
            {% if current_key %}
            <p class="text-xs text-emerald-600 mt-2">Key is configured and saved.</p>
            {% else %}
            <p class="text-xs text-amber-600 mt-2">No key configured. AI features will not work until a key is provided.</p>
            {% endif %}
            {% endif %}
        </div>

        <!-- Light Enhancement -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center gap-3 mb-3">
                <span class="inline-flex px-2.5 py-1 text-xs font-semibold rounded-full bg-emerald-100 text-emerald-700">Light</span>
                <h2 class="font-semibold text-gray-900">Light Enhancement Prompt</h2>
            </div>
            <p class="text-sm text-gray-500 mb-3">Grammar, spelling, punctuation, and minor clarity fixes. No meaning changes.</p>
            <textarea name="enhance_light" rows="6"
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 outline-none transition-all text-sm font-mono resize-y"
                >{{ settings.get('enhance_light', {}).get('value', '') }}</textarea>
            {% if settings.get('enhance_light', {}).get('updated_at') %}
            <p class="text-xs text-gray-400 mt-1">Last updated: {{ settings['enhance_light']['updated_at'] }}</p>
            {% endif %}
        </div>

        <!-- Medium Enhancement -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center gap-3 mb-3">
                <span class="inline-flex px-2.5 py-1 text-xs font-semibold rounded-full bg-amber-100 text-amber-700">Medium</span>
                <h2 class="font-semibold text-gray-900">Medium Enhancement Prompt</h2>
            </div>
            <p class="text-sm text-gray-500 mb-3">Rewrites for clarity, professionalism, and impact. Sharpens vague language.</p>
            <textarea name="enhance_medium" rows="8"
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 outline-none transition-all text-sm font-mono resize-y"
                >{{ settings.get('enhance_medium', {}).get('value', '') }}</textarea>
            {% if settings.get('enhance_medium', {}).get('updated_at') %}
            <p class="text-xs text-gray-400 mt-1">Last updated: {{ settings['enhance_medium']['updated_at'] }}</p>
            {% endif %}
        </div>

        <!-- Heavy Enhancement -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center gap-3 mb-3">
                <span class="inline-flex px-2.5 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-700">Heavy</span>
                <h2 class="font-semibold text-gray-900">Heavy Enhancement Prompt</h2>
            </div>
            <p class="text-sm text-gray-500 mb-3">Substantial expansion, best practices, structured thinking, and enrichment.</p>
            <textarea name="enhance_heavy" rows="10"
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 outline-none transition-all text-sm font-mono resize-y"
                >{{ settings.get('enhance_heavy', {}).get('value', '') }}</textarea>
            {% if settings.get('enhance_heavy', {}).get('updated_at') %}
            <p class="text-xs text-gray-400 mt-1">Last updated: {{ settings['enhance_heavy']['updated_at'] }}</p>
            {% endif %}
        </div>

        <div class="flex items-center gap-3">
            <button type="submit" class="px-5 py-2.5 bg-brand-600 text-white font-medium rounded-lg hover:bg-brand-700 transition-colors">
                Save All Settings
            </button>
            <a href="/" class="px-5 py-2.5 text-gray-600 font-medium rounded-lg hover:bg-gray-100 transition-colors">
                Cancel
            </a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
const toggle = document.getElementById('toggle-key-vis');
if (toggle) {
    const input = document.getElementById('api-key-input');
    const eyeOpen = toggle.querySelector('.eye-open');
    const eyeClosed = toggle.querySelector('.eye-closed');
    toggle.addEventListener('click', () => {
        const show = input.type === 'password';
        input.type = show ? 'text' : 'password';
        eyeOpen.classList.toggle('hidden', show);
        eyeClosed.classList.toggle('hidden', !show);
    });
}
</script>
{% endblock %}
